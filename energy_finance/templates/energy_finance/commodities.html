{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">Commodity Data</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <select id="dataSource" class="form-select" onchange="updateCommodityList()">
                                <option value="fmp">Financial Modeling Prep</option>
                                <option value="commodity_price_api">Commodity Price API</option>
                                <option value="api_ninjas">API Ninjas</option>
                                <option value="alpha_vantage">Alpha Vantage</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select id="commoditySelect" class="form-select">
                                <option value="">Select a commodity</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary" onclick="getCommodityData()">Get Data</button>
                        </div>
                    </div>
                    <div id="commodityChart"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateCommodityList() {
    const source = document.getElementById('dataSource').value;
    const select = document.getElementById('commoditySelect');
    select.innerHTML = '<option value="">Select a commodity</option>';

    fetch(`/api/params?source=${source}`)
        .then(response => response.json())
        .then(data => {
            if (Array.isArray(data)) {
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.symbol || item.name;
                    option.textContent = item.name || item.symbol;
                    select.appendChild(option);
                });
            } else if (data.error) {
                console.error('Error:', data.error);
            }
        })
        .catch(error => console.error('Error loading commodities:', error));
}

function getCommodityData() {
    const source = document.getElementById('dataSource').value;
    const commodity = document.getElementById('commoditySelect').value;
    
    if (!commodity) {
        alert('Please select a commodity');
        return;
    }

    let url;
    if (source === 'alpha_vantage') {
        url = `/api/commodity-data?commodity=${commodity}`;
    } else {
        url = `/api/commodities?source=${source}&name=${commodity}`;
    }

    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error('Error:', data.error);
                return;
            }
            // Process and display commodity data
            console.log('Commodity data:', data);
            // TODO: Add visualization code here
        })
        .catch(error => console.error('Error fetching commodity data:', error));
}

// Load initial commodity list
document.addEventListener('DOMContentLoaded', updateCommodityList);
</script>
{% endblock %} 