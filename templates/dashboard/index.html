<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Energy Finance Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <style>
        .source-badge {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            font-weight: 600;
        }
        .data-card {
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .source-info {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 8px;
        }
        .controls-row {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .chart-container {
            min-height: 400px;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        body.dark-mode {
            background-color: #181a1b !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .card,
        .dark-mode .navbar,
        .dark-mode .form-control,
        .dark-mode .form-select {
            background-color: #23272b !important;
            color: #e0e0e0 !important;
            border-color: #444 !important;
        }
        .dark-mode .chart-container {
            background: #23272b !important;
        }
        .dark-mode .nav-tabs .nav-link {
            color: #e0e0e0 !important;
        }
        .dark-mode .nav-tabs .nav-link.active {
            color: #fff !important;
            background-color: #23272b !important;
        }
        .dark-mode .controls-row {
            background: #23272b !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class='bx bx-line-chart'></i> Energy Finance Dashboard
            </a>
            <div class="form-check form-switch ms-3">
                <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                <label class="form-check-label text-light" for="darkModeSwitch">Dark Mode</label>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="commodities-tab" data-bs-toggle="tab" href="#commodities" role="tab">
                    <i class='bx bx-package'></i> Commodities
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="weather-tab" data-bs-toggle="tab" href="#weather" role="tab">
                    <i class='bx bx-cloud'></i> Weather
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="energy-tab" data-bs-toggle="tab" href="#energy" role="tab">
                    <i class='bx bx-bulb'></i> Energy Prices
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="energy-analysis-tab" data-bs-toggle="tab" href="#energy-analysis" role="tab">
                    <i class='bx bx-line-chart-down'></i> Energy Analytics
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="renewables-tab" data-bs-toggle="tab" href="#renewables" role="tab">
                    <i class='bx bx-leaf'></i> Renewables Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="us-energy-tab" data-bs-toggle="tab" href="#us-energy" role="tab">
                    <i class='bx bx-flag-alt'></i> US Energy (EIA)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="economic-data-tab" data-bs-toggle="tab" href="#economic-data" role="tab">
                    <i class='bx bx-trending-up'></i> Economic Data (FRED)
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="portfolio-tab" data-bs-toggle="tab" href="#portfolio" role="tab">
                    <i class='bx bx-pie-chart-alt-2'></i> Portfolio Analytics
                </a>
            </li>
        </ul>

        <div class="tab-content mt-3" id="dashboardTabsContent">
            <!-- Commodities Tab -->
            <div class="tab-pane fade show active" id="commodities" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Data Source</label>
                            <select class="form-select" id="data-source">
                                <option value="fmp">Financial Modeling Prep</option>
                                <option value="commodity_price_api">CommodityPriceAPI</option>
                                <option value="api_ninjas">API Ninjas</option>
                                <option value="alpha_vantage">Alpha Vantage</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Asset</label>
                            <select class="form-select" id="asset-select">
                                <option value="" disabled selected>Select a commodity</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Technical Oscillators</label>
                            <select class="form-select" id="oscillator-select">
                                <option value="none">None</option>
                                <optgroup label="Kaufman Oscillators">
                                    <option value="kama">KAMA (Adaptive MA)</option>
                                    <option value="price_osc">Price Oscillator</option>
                                    <option value="cci_enhanced">Enhanced CCI</option>
                                    <option value="momentum">Momentum</option>
                                    <option value="roc">Rate of Change</option>
                                    <option value="smi">Stochastic Momentum</option>
                                    <option value="efficiency_ratio">Efficiency Ratio</option>
                                </optgroup>
                                <optgroup label="Ehlers DSP Oscillators">
                                    <option value="fisher_transform">Fisher Transform</option>
                                    <option value="stochastic_cg">Stochastic Center of Gravity</option>
                                    <option value="super_smoother">Super Smoother</option>
                                    <option value="cycle_period">Cycle Period Detection</option>
                                    <option value="mama">MESA Adaptive MA (MAMA)</option>
                                    <option value="sinewave">Sinewave Indicator</option>
                                    <option value="hilbert_transform">Hilbert Transform</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Time Range</label>
                            <select class="form-select" id="commodity-time-range">
                                <option value="1d">1 Day</option>
                                <option value="1w">1 Week</option>
                                <option value="1m">1 Month</option>
                                <option value="3m">3 Months</option>
                                <option value="1y">1 Year</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card data-card">
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="commodity-chart"></div>
                                </div>
                                <div class="chart-container" style="margin-top: 30px;">
                                    <div id="oscillator-chart"></div>
                                </div>
                                <div class="source-info">
                                    <i class='bx bx-link'></i> Data Sources: Alpha Vantage, API Ninjas, Financial Modeling Prep
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weather Tab -->
            <div class="tab-pane fade" id="weather" role="tabpanel" aria-labelledby="weather-tab">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="citySearch" placeholder="Enter city name">
                            <button class="btn btn-primary" onclick="createWeatherChart()">Search</button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div id="weatherChart"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div id="weatherMetricsChart"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Energy System Tab -->
            <div class="tab-pane fade" id="energy" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Country</label>
                            <select class="form-select" id="energy-country">
                                <!-- Western Europe -->
                                <option value="DE" selected>Germany</option>
                                <option value="FR">France</option>
                                <option value="ES">Spain</option>
                                <option value="IT">Italy</option>
                                <option value="AT">Austria</option>
                                <option value="NL">Netherlands</option>
                                <option value="BE">Belgium</option>
                                <option value="CH">Switzerland</option>
                                <option value="PT">Portugal</option>
                                <option value="LU">Luxembourg</option>
                                
                                <!-- Northern Europe -->
                                <option value="DK">Denmark</option>
                                <option value="SE">Sweden</option>
                                <option value="NO">Norway</option>
                                <option value="FI">Finland</option>
                                <option value="IE">Ireland</option>
                                <option value="GB">United Kingdom</option>
                                
                                <!-- Central & Eastern Europe -->
                                <option value="PL">Poland</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="SK">Slovakia</option>
                                <option value="HU">Hungary</option>
                                <option value="SI">Slovenia</option>
                                <option value="HR">Croatia</option>
                                <option value="RO">Romania</option>
                                <option value="BG">Bulgaria</option>
                                <option value="EE">Estonia</option>
                                <option value="LV">Latvia</option>
                                <option value="LT">Lithuania</option>
                                
                                <!-- Southern Europe -->
                                <option value="GR">Greece</option>
                                <option value="MT">Malta</option>
                                <option value="CY">Cyprus</option>
                                
                                <!-- Balkan Region -->
                                <option value="RS">Serbia</option>
                                <option value="BA">Bosnia and Herzegovina</option>
                                <option value="ME">Montenegro</option>
                                <option value="MK">North Macedonia</option>
                                <option value="AL">Albania</option>
                                
                                <!-- Nordic & Energy Leaders -->
                                <option value="IS">Iceland</option>
                                
                                <!-- Eastern Europe & Turkey -->
                                <option value="TR">Turkey</option>
                                <option value="UA">Ukraine</option>
                                <option value="MD">Moldova</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Analysis Type</label>
                            <select class="form-select" id="energy-data-type">
                                <option value="price">Electricity Prices (€/MWh)</option>
                                <option value="generation">Power Generation Mix (MW)</option>
                                <option value="renewable_share">Renewable Energy Share (%)</option>
                                <option value="load">Electricity Demand (MW)</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Time Range</label>
                            <select class="form-select" id="energy-time-range">
                                <option value="1d">1 Day</option>
                                <option value="3d">3 Days</option>
                                <option value="1w" selected>1 Week</option>
                                <option value="2w">2 Weeks</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary mt-4" onclick="createEnergyChart()">
                                <i class='bx bx-refresh'></i> Load Data
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card data-card">
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="energy-chart"></div>
                                </div>
                                <div class="source-info">
                                    <i class='bx bx-link'></i> Sources: <span class="source-badge bg-primary text-white" id="energy-source-badge">Hybrid API</span> ENTSO-E & Energy Charts API
                                    <br><small class="text-muted">Intelligent data routing: ENTSO-E for prices, Energy Charts for generation & renewables. Automatic fallback ensures data availability.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Energy Analytics Dashboard -->
            <div class="tab-pane fade" id="energy-analysis" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-2">
                            <label class="form-label">Country</label>
                            <select class="form-select" id="analysis-country">
                                <!-- Western Europe -->
                                <option value="DE" selected>Germany</option>
                                <option value="FR">France</option>
                                <option value="ES">Spain</option>
                                <option value="IT">Italy</option>
                                <option value="AT">Austria</option>
                                <option value="NL">Netherlands</option>
                                <option value="BE">Belgium</option>
                                <option value="CH">Switzerland</option>
                                <option value="PT">Portugal</option>
                                <option value="LU">Luxembourg</option>
                                
                                <!-- Northern Europe -->
                                <option value="DK">Denmark</option>
                                <option value="SE">Sweden</option>
                                <option value="NO">Norway</option>
                                <option value="FI">Finland</option>
                                <option value="IE">Ireland</option>
                                <option value="GB">United Kingdom</option>
                                
                                <!-- Central & Eastern Europe -->
                                <option value="PL">Poland</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="SK">Slovakia</option>
                                <option value="HU">Hungary</option>
                                <option value="SI">Slovenia</option>
                                <option value="HR">Croatia</option>
                                <option value="RO">Romania</option>
                                <option value="BG">Bulgaria</option>
                                <option value="EE">Estonia</option>
                                <option value="LV">Latvia</option>
                                <option value="LT">Lithuania</option>
                                
                                <!-- Southern Europe -->
                                <option value="GR">Greece</option>
                                <option value="MT">Malta</option>
                                <option value="CY">Cyprus</option>
                                
                                <!-- Balkan Region -->
                                <option value="RS">Serbia</option>
                                <option value="BA">Bosnia and Herzegovina</option>
                                <option value="ME">Montenegro</option>
                                <option value="MK">North Macedonia</option>
                                <option value="AL">Albania</option>
                                
                                <!-- Nordic & Energy Leaders -->
                                <option value="IS">Iceland</option>
                                
                                <!-- Eastern Europe & Turkey -->
                                <option value="TR">Turkey</option>
                                <option value="UA">Ukraine</option>
                                <option value="MD">Moldova</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Time Range</label>
                            <select class="form-select" id="analysis-time-range">
                                <option value="1d">1 Day</option>
                                <option value="3d">3 Days</option>
                                <option value="1w" selected>1 Week</option>
                                <option value="2w">2 Weeks</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary mt-4" onclick="createAnalyticsDashboard()">
                                <i class='bx bx-refresh'></i> Load Analytics
                            </button>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-info mt-4 mb-0">
                                <small><i class='bx bx-info-circle'></i> Comprehensive energy market analysis combining price, generation, and demand data</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-money'></i> Electricity Prices</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="analytics-price-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-trending-up'></i> Electricity Demand</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="analytics-load-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-cog'></i> Power Generation Mix</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="analytics-generation-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="source-info">
                    <i class='bx bx-link'></i> Sources: ENTSO-E Transparency Platform & Energy Charts API
                    <br><small class="text-muted">Real-time electricity market data for comprehensive energy trading analysis. Hybrid approach automatically selects optimal data source.</small>
                </div>
            </div>

            <!-- Renewables Dashboard -->
            <div class="tab-pane fade" id="renewables" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-2">
                            <label class="form-label">Country</label>
                            <select class="form-select" id="renewables-country">
                                <!-- Western Europe -->
                                <option value="DE" selected>Germany</option>
                                <option value="FR">France</option>
                                <option value="ES">Spain</option>
                                <option value="IT">Italy</option>
                                <option value="AT">Austria</option>
                                <option value="NL">Netherlands</option>
                                <option value="BE">Belgium</option>
                                <option value="CH">Switzerland</option>
                                <option value="PT">Portugal</option>
                                <option value="LU">Luxembourg</option>
                                
                                <!-- Northern Europe -->
                                <option value="DK">Denmark</option>
                                <option value="SE">Sweden</option>
                                <option value="NO">Norway</option>
                                <option value="FI">Finland</option>
                                <option value="IE">Ireland</option>
                                <option value="GB">United Kingdom</option>
                                
                                <!-- Central & Eastern Europe -->
                                <option value="PL">Poland</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="SK">Slovakia</option>
                                <option value="HU">Hungary</option>
                                <option value="SI">Slovenia</option>
                                <option value="HR">Croatia</option>
                                <option value="RO">Romania</option>
                                <option value="BG">Bulgaria</option>
                                <option value="EE">Estonia</option>
                                <option value="LV">Latvia</option>
                                <option value="LT">Lithuania</option>
                                
                                <!-- Southern Europe -->
                                <option value="GR">Greece</option>
                                <option value="MT">Malta</option>
                                <option value="CY">Cyprus</option>
                                
                                <!-- Balkan Region -->
                                <option value="RS">Serbia</option>
                                <option value="BA">Bosnia and Herzegovina</option>
                                <option value="ME">Montenegro</option>
                                <option value="MK">North Macedonia</option>
                                <option value="AL">Albania</option>
                                
                                <!-- Nordic & Energy Leaders -->
                                <option value="IS">Iceland</option>
                                
                                <!-- Eastern Europe & Turkey -->
                                <option value="TR">Turkey</option>
                                <option value="UA">Ukraine</option>
                                <option value="MD">Moldova</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Time Range</label>
                            <select class="form-select" id="renewables-time-range">
                                <option value="1d">1 Day</option>
                                <option value="3d">3 Days</option>
                                <option value="1w" selected>1 Week</option>
                                <option value="2w">2 Weeks</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-success mt-4" onclick="createRenewablesDashboard()">
                                <i class='bx bx-leaf'></i> Load Data
                            </button>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success mt-4 mb-0">
                                <small><i class='bx bx-leaf'></i> Renewable energy analysis including solar, wind, hydro and biomass generation</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-pie-chart-alt-2'></i> Renewable Share</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="renewables-share-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-sun'></i> Renewable vs Fossil</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="renewables-vs-fossil-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-wind'></i> Renewable Generation Sources</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="renewables-sources-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="source-info">
                    <i class='bx bx-link'></i> Source: Energy Charts API (Fraunhofer ISE)
                    <br><small class="text-muted">High-resolution renewable energy data from German energy research institute. Updated hourly with detailed breakdown by technology.</small>
                </div>
            </div>

            <!-- Portfolio Analytics Tab -->
            <div class="tab-pane fade" id="portfolio" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-2">
                            <label class="form-label">Analysis Type</label>
                            <select class="form-select" id="portfolio-analysis-type">
                                <option value="overview">Portfolio Overview</option>
                                <option value="risk">Risk Analysis</option>
                                <option value="simulation">Monte Carlo</option>
                                <option value="optimization">Optimization</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Risk Tolerance</label>
                            <select class="form-select" id="portfolio-risk-tolerance">
                                <option value="conservative">Conservative</option>
                                <option value="moderate" selected>Moderate</option>
                                <option value="aggressive">Aggressive</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Time Horizon</label>
                            <select class="form-select" id="portfolio-time-horizon">
                                <option value="30">1 Month</option>
                                <option value="90" selected>3 Months</option>
                                <option value="252">1 Year</option>
                                <option value="504">2 Years</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-success mt-4" onclick="loadSamplePortfolio()">
                                <i class='bx bx-download'></i> Load Sample Portfolio
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary mt-4" onclick="analyzePortfolio()">
                                <i class='bx bx-bar-chart-alt-2'></i> Analyze Portfolio
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Composition -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-pie-chart-alt-2'></i> Portfolio Composition</h5>
                                <div class="card-tools">
                                    <button class="btn btn-sm btn-outline-primary" onclick="addCommodityToPortfolio()">
                                        <i class='bx bx-plus'></i> Add Commodity
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="portfolio-composition">
                                    <div class="alert alert-info">
                                        <i class='bx bx-info-circle'></i> 
                                        Click "Load Sample Portfolio" to start with a diversified commodity portfolio, or use "Add Commodity" to build your own.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="row" id="portfolio-analysis-results" style="display: none;">
                    <!-- Risk Metrics -->
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-shield-alt-2'></i> Risk Metrics</h5>
                            </div>
                            <div class="card-body">
                                <div id="portfolio-risk-metrics"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-trending-up'></i> Performance Metrics</h5>
                            </div>
                            <div class="card-body">
                                <div id="portfolio-performance-metrics"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3" id="portfolio-charts-row" style="display: none;">
                    <!-- Portfolio Correlation Matrix -->
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-grid-alt'></i> Correlation Matrix</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="portfolio-correlation-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Decomposition -->
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-doughnut-chart'></i> Risk Contribution</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="portfolio-risk-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monte Carlo Results -->
                <div class="row mt-3" id="portfolio-simulation-row" style="display: none;">
                    <div class="col-md-8">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-line-chart'></i> Monte Carlo Simulation Paths</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="portfolio-simulation-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-bar-chart-square'></i> Return Distribution</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="portfolio-distribution-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Optimization Results -->
                <div class="row mt-3" id="portfolio-optimization-row" style="display: none;">
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-target-lock'></i> Optimal Weights</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <div id="portfolio-optimization-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card data-card">
                            <div class="card-header">
                                <h5><i class='bx bx-transfer'></i> Weight Changes</h5>
                            </div>
                            <div class="card-body">
                                <div id="portfolio-weight-changes"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="source-info mt-3">
                    <i class='bx bx-link'></i> Portfolio Analytics powered by Modern Portfolio Theory & Monte Carlo simulation
                </div>
            </div>

            <!-- US Energy (EIA) Tab -->
            <div class="tab-pane fade" id="us-energy" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Data Type</label>
                            <select class="form-select" id="us-energy-type">
                                <option value="electricity_generation">Electricity Generation</option>
                                <option value="electricity_prices">Electricity Prices</option>
                                <option value="natural_gas">Natural Gas</option>
                                <option value="renewable_energy">Renewable Energy</option>
                                <option value="petroleum">Petroleum</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">State/Region</label>
                            <select class="form-select" id="us-state">
                                <option value="">National</option>
                                <optgroup label="Major States">
                                    <option value="CA">California</option>
                                    <option value="TX">Texas</option>
                                    <option value="FL">Florida</option>
                                    <option value="NY">New York</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="IL">Illinois</option>
                                    <option value="OH">Ohio</option>
                                    <option value="GA">Georgia</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="MI">Michigan</option>
                                </optgroup>
                                <optgroup label="All States">
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="DC">District of Columbia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Sub-Type</label>
                            <select class="form-select" id="us-energy-subtype">
                                <!-- Options will be populated based on energy type -->
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Start Date</label>
                            <input type="month" class="form-control" id="us-start-date">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">End Date</label>
                            <input type="month" class="form-control" id="us-end-date">
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button class="btn btn-primary w-100" id="fetch-us-energy">
                                <i class='bx bx-search'></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <h5 id="us-energy-chart-title">US Energy Data</h5>
                            <div id="us-energy-chart"></div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4" id="us-energy-comparison" style="display: none;">
                    <div class="col-12">
                        <div class="chart-container">
                            <h5>US vs European Energy Comparison</h5>
                            <canvas id="us-europe-comparison-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row mt-4" id="us-energy-stats" style="display: none;">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Latest Value</h5>
                                <p class="card-text display-6" id="us-latest-value">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Period Change</h5>
                                <p class="card-text display-6" id="us-period-change">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Average</h5>
                                <p class="card-text display-6" id="us-average-value">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Trend</h5>
                                <p class="card-text display-6" id="us-trend">-</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="source-info mt-3">
                    <i class='bx bx-flag-alt'></i> US Energy data powered by Energy Information Administration (EIA) | 
                    <a href="https://www.eia.gov/" target="_blank">Official EIA Website</a>
                </div>
            </div>

            <!-- Economic Data (FRED) Tab -->
            <div class="tab-pane fade" id="economic-data" role="tabpanel">
                <div class="controls-row">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Economic Indicator</label>
                            <select class="form-select" id="fred-indicator">
                                <option value="GDP">Gross Domestic Product (GDP)</option>
                                <option value="CPIAUCSL">Consumer Price Index (CPI)</option>
                                <option value="UNRATE">Unemployment Rate</option>
                                <option value="FEDFUNDS">Federal Funds Rate</option>
                                <option value="TB3MS">3-Month Treasury Rate</option>
                                <option value="DGS10">10-Year Treasury Rate</option>
                                <option value="PAYEMS">Nonfarm Payrolls</option>
                                <option value="INDPRO">Industrial Production</option>
                                <option value="HOUST">Housing Starts</option>
                                <option value="DEXUSEU">USD/EUR Exchange Rate</option>
                                <option value="DCOILWTICO">WTI Oil Price</option>
                                <option value="GOLDAMGBD228NLBM">Gold Price</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Frequency</label>
                            <select class="form-select" id="fred-frequency">
                                <option value="d">Daily</option>
                                <option value="w">Weekly</option>
                                <option value="m" selected>Monthly</option>
                                <option value="q">Quarterly</option>
                                <option value="a">Annual</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="fred-start-date">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-control" id="fred-end-date">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Transform</label>
                            <select class="form-select" id="fred-transform">
                                <option value="lin">Level</option>
                                <option value="chg">Change</option>
                                <option value="ch1">Change from Year Ago</option>
                                <option value="pch">Percent Change</option>
                                <option value="pc1">Percent Change from Year Ago</option>
                                <option value="pca">Compounded Annual Rate</option>
                                <option value="cch">Continuously Compounded Rate</option>
                                <option value="cca">Continuously Compounded Annual Rate</option>
                                <option value="log">Natural Log</option>
                            </select>
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button class="btn btn-primary w-100" id="fetch-fred-data">
                                <i class='bx bx-search'></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Advanced Controls Row -->
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label class="form-label">Search Indicators</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="fred-search-text" placeholder="Search economic indicators...">
                                <button class="btn btn-outline-secondary" type="button" id="search-fred-indicators">
                                    <i class='bx bx-search'></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Compare Multiple Series</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="fred-multi-series">
                                <label class="form-check-label" for="fred-multi-series">
                                    Enable comparison mode
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Chart Type</label>
                            <select class="form-select" id="fred-chart-type">
                                <option value="line">Line Chart</option>
                                <option value="bar">Bar Chart</option>
                                <option value="scatter">Scatter Plot</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <h5 id="fred-chart-title">Economic Indicator Data</h5>
                            <div id="fred-chart"></div>
                        </div>
                    </div>
                </div>

                <!-- Multiple Series Section -->
                <div class="row mt-4" id="fred-multi-section" style="display: none;">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Multiple Series Comparison</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <label class="form-label">Additional Series (comma-separated)</label>
                                        <input type="text" class="form-control" id="fred-additional-series" 
                                               placeholder="e.g., UNRATE,FEDFUNDS,GDP">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button class="btn btn-success w-100" id="fetch-fred-multiple">
                                            <i class='bx bx-line-chart'></i> Compare Series
                                        </button>
                                    </div>
                                </div>
                                <div class="chart-container mt-3">
                                    <div id="fred-multi-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mt-4" id="fred-stats" style="display: none;">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Latest Value</h5>
                                <p class="card-text display-6" id="fred-latest-value">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Period Change</h5>
                                <p class="card-text display-6" id="fred-period-change">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Average</h5>
                                <p class="card-text display-6" id="fred-average-value">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Volatility</h5>
                                <p class="card-text display-6" id="fred-volatility">-</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Results -->
                <div class="row mt-4" id="fred-search-results" style="display: none;">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Search Results</h6>
                            </div>
                            <div class="card-body">
                                <div id="fred-search-list" class="list-group">
                                    <!-- Search results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="source-info mt-3">
                    <i class='bx bx-trending-up'></i> Economic data powered by Federal Reserve Economic Data (FRED) | 
                    <a href="https://fred.stlouisfed.org/" target="_blank">Official FRED Website</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="/static/js/dashboard.js?v=20250607-1500"></script>
</body>
</html>